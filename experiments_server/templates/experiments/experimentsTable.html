<h2>Experiment Results</h2>

<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>Experiment ID</th>
            <th>Timestamp</th>
            <th>Force Y</th>
            <th>Top Nodes Y</th>
            <th>Force X</th>
            <th>Force Z</th>
            <th>Torsional Force</th>
            <th>Equilibrium After Seconds</th>
            <th>Time to Box Explosion</th>
            <th>Max Volume</th>
            <th>Time to Strain Explosion</th>
            <th>Max Strain</th>
            <th>Time to Velocity Spike</th>
            <th>Max Velocity</th>
            <th>Height Under Load</th>
            <th>Final Height</th>
            <th title="This is the image of the final screenshot of the image due to max time exceeded or explosion conditions have been met">Final Experiment Screenshot</th>
            <th>Run Simulation</th>
        </tr>
    </thead>
    <tbody>
        {% for experiment in experiments %}
        <tr>
            <td>{{ experiment.experiment_id }}</td>
            <td>{{ experiment.timestamp.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3] if experiment.timestamp else '' }}</td>
            <td>{{ experiment.force_in_y_direction }}</td>
            <td>{{ experiment.force_top_nodes_in_y_direction }}</td>
            <td>{{ experiment.force_in_x_direction }}</td>
            <td>{{ experiment.force_in_z_direction }}</td>
            <td>{{ experiment.torsional_force }}</td>
            <td>{{ experiment.equilibrium_after_seconds }}</td>
            <td>{{ experiment.time_to_bounding_box_explosion }}</td>
            <td>{{ experiment.max_bounding_box_volume }}</td>
            <td>{{ experiment.time_to_beam_strain_exceed_explosion }}</td>
            <td>{{ experiment.max_beam_strain }}</td>
            <td>{{ experiment.time_to_node_velocity_spike_explosion }}</td>
            <td>{{ experiment.max_node_velocity }}</td>
            <td>{{ experiment.height_under_load }}</td>
            <td>{{ experiment.final_height }}</td>
            <td>
                <img src="/assets/{{ experiment_series.experiment_series_name }}/{{ experiment_series.experiment_series_name }}_{{ experiment.experiment_id }}.jpg"
                     alt="Experiment Image Not Found Error"
                     class="modal-trigger"
                     style="max-width: 100%; height: auto; cursor: pointer;">
            </td>
            <td><button class="run-btn" data-experiment-id="{{ experiment.experiment_id }}">▶️</button></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>
    document.querySelectorAll('.run-btn').forEach(button => {
        button.addEventListener('click', () => {
            const experimentId = button.dataset.experimentId;
            const seriesName = "{{ experiment_series.experiment_series_name }}";
            fetch(`/api/experiments/visualize_single/${seriesName}/${experimentId}`, {
                method: "POST"
            }).then(response => {
                if (!response.ok) {
                    console.error("Failed to start experiment:", response.status);
                }
            });
        });
    });
</script>